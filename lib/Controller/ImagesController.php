<?php

namespace OCA\OpenCatalogi\Controller;

ini_set('memory_limit', '2048M');

use OCP\AppFramework\Controller;
use OCP\AppFramework\Http\JSONResponse;
use OCP\IAppConfig;
use OCP\IRequest;
/**
 * Class ImagesController
 *
 * This controller handles images in the OpenCatalogi app.
 */
class ImagesController extends Controller
{
    /**
     * ImagesController constructor.
     *
     * @param string $appName The name of the app
     * @param IRequest $request The request object
     * @param IAppConfig $config The app configuration
     */
    public function __construct
	(
		$appName,
		IRequest $request,
		private readonly IAppConfig $config,
	)
    {
        parent::__construct($appName, $request);
    }

	/**
	 * Fetch image from given url.
	 *
	 * @return JSONResponse The response containing the fetched image.
	 *
	 * @NoAdminRequired
	 * @NoCSRFRequired
	 */
    public function proxy(): JSONResponse
    {
        // Get all parameters from the request
        $data = $this->request->getParams();
        if (isset($data['url']) === false && filter_var($data['url'], FILTER_VALIDATE_URL) !== false) {
            return new JSONResponse(['message' => 'No url or invalid url given'], 400);
        }
        $url = $data['url'];

        // @todo this is a mock endpoint and needs to be done properly

        return new JSONResponse(['base64' => 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAkGBxMSEhISEhIVFRUQEBUVEhUVFRUVFQ8VFRUWFhUVFRUYHSggGBolHRUVITEhJSkrLi4uFx8zODMtNygtLisBCgoKDg0OGhAQGi0dHR0tLS0tLSstLS0tKy0tLS0vLS0rLS0tLS0tLSstLS0tLS0tLS0tLS8tLS0tLS0tLS0rLf/AABEIALcBEwMBIgACEQEDEQH/xAAbAAABBQEBAAAAAAAAAAAAAAADAAECBAUGB//EAD0QAAEDAgQDBQUHAgUFAAAAAAEAAhEDBAUSITFBUWETInGBsQYUkaHBMkJSYtHh8IKyBxUjM6IWQ3KS8f/EABoBAAIDAQEAAAAAAAAAAAAAAAABAgMEBQb/xAAtEQACAgIBAwIEBQUAAAAAAAAAAQIRAyESBDFBMlEFE2FxIiNCgfAzkbHR4f/aAAwDAQACEQMRAD8A7GpZk7JNsXDitQBTatVWZEZfujlFtm+d1thillSpDoxm2j+Kn7oVsZVGoxAUYJs3zMpsh4rVeANysnE7prOM+GkKuTLIxKt5VDBM6LEu8aGuUkSCPkqOMYiXyJ0n4xxXL4jiUZuQ0HDMevL9lQ5WaVE3cWx6co5NiPHisoYrXeJDsoHx9VjGgXRUzSHDU9R9odNeHVCpPBfEHkeuh69UrHxO5wfHKzYl89HSQfPVdjYYpnAnSV5RZDLGRxgHbp0H1XT4PfPaRmjLO/LxH1UuVEHE714cdiYRbCk4faMqlh16HQJ3C3aVKVbB2UzjQwfCi+4RjaoZsldsrBtuE9SuY0KL7kFH3JGxFcV3cwmN0eaO7D+qEcN6o2ACpiMcUJuJknQqxUwqU1PCoKKYmEpXhO4VgV1KnZAKx2AU0xUyt2oKg+qArXYBQdbA8FK0KmVhXaiNqhT9zbyTm2CLCmCdVCq170NVl9uqte26IDYOneZtgpiRrKDTbl4JPqHkqndktVska6SDn6J0WwpGkAptCG2oOaI1wSsaQViJKEHhEa4JWMmCov10RAmfAHqk2NGRidXICcw4+S4nEqxfJmG+Qzfst72grl502n4jYD6rlsWOVpnc8NFhlluRvx4qiYWL3oYJPeOwHoJP7qlh9qyox5fx31nLOzuf7FVbq3dUfmMho2J0AHNM/ERThtLXmYPe4QpKQ+JYqVezIZEtO20RzbzTPY3fMB10+qcRuSGk7tMEfBUrmoJgAeeqd2LiTq3TQQGkaaAgT/NVrYXduOmvI8lh0GiZGpPHkt7C4AJ5H6J0I6bCqjmnpyXoeC1w9q8zt7rL8AumwG7IIzaTwU4umVTVo7uAmyqrQdIkKw0rQmZ2qJZEuzUgUsydsVDdmolinKRQAMNT5VMBPCLHRBNCnlShAgeVLKiQlCdsKBFqiWopUSEWFASFAtVghRcFJSFRWc1DdT6KwWpnBNzFxKvZDkmR4SUeYcTladw7mrVK7cqDFYYqbJpI0GXZ5KxTuys9hVhqLZKkX23p5Id9ey3L+L04/RBCp3T5eAOED6/VU5p8Y/ctwwTkVbrU+HrwXK40Y1drxjhE8V1d2QAT/NFx2LVc8nhxPygLmSdM6eNWjlL15qOkiY6beAQ2U3DZuvwhaz6Uaxr90fVVqlEwZ+eqtWQl8oovpjckDwk+Q1VUNk6CBz4nzWlTsS7f/wCJOoajlOnU8SrYzRVLGRs6Wm3h4zotG0G4/N6KdpbaaDb1R6dKHHo39FJzK/ll/Dmy7Mesfr9PJdFaO1I/DJ/VYWHaeXqVqMqhpJ5mPipxkVTidlg11IglbjWriMIuoMHYmPkuotr05RO40PiDH0V+OVmWcaNNJUheqXvoVtkC0kq4uwp+8hOxBoTQoC4CftRzQMfKnhIPCWZFiobKnyp8yUpWOkMQolqmSoosKQMqDkVyG4KSYqBEobiUYoT0+QqB5kk6SfIVHHMKsUyq7FYpqlkqLLEdhVZjlYYUmySDtVK3Gao88nD0aVbJ0Pgq+Cslr3c6h+Wn0WfPtpGjBq2YvtHUOYUmmBlLnu/AyZJ8SYA8+Sw3UNB3TH3W8Xft/OS6zEbCXFx1mNOGm084k/FUH2o1M681gnHZ0cclRhMsQAX1InieDRyCrG1NQzEN+6OJ6rcr2YOriTG07DyUHUQR05c0cSxSOfrUx9lomN44+fAdU1vhpJl2nQekrcNMDZTZAVkY+5XOXsQoWoAiAs9tGXP8Q0fD91rufos6g3vub+cnxBb+s/BMh4C2lHUDqXO8o0+Y+CHeV4cR+YfX9Fft6erjzA+p+qxr4f6oHM+im9IrStm/gtQugfnb6wu1AXI+ylGX+He+B09V2C1YuxiyvZGEoUklaVWQSU00JUMjKWY81KE2VADiqeal7w5DhMnsA3vTlIXZVdMi2FIs++lP78qZCg5O2HFF04goHEAqLkF6dsOKNB2IBDOIBZj0BylyZHibP+YNTLEhJHNhxQEAozCQnYEdgUAHpKyxRYAithRJEtI8lO1YKdITxJP/ALEn6qJbw5qOIVIEASANgOSozOnZfh2qM68xETqDCouvGO2MLm8axq67VtKlQyh7sofVkNny/mq5Gv7XV2u1psOpnKXiIMEEkLKoTltG5yhDUtHpVepOkqDtoCx8CvO2aHQRO4O7TutKsSJUNp0yxU+wItJKMqz68aqt771AnmQPVSsVGjBOykLYEg8Qqbbmo3aCPKVo2N2HaO0KnBplU4tdg9KnHwHyWFeD/VcfIeZk+i6hlJZGJYfrPMkqc46KoSRu+y1KGF3Fw+Wi3ZWN7PUyGCRAy6ddVsLVj9KMeT1MlmSzKKSsIEsyUqKSAJZksyimQBKUlGUpQMdMlKUoAYqDlIlQJQBByA9GcgvKAAPQXIzygOKYmyEpJiUkCIWlw140KtsaVnMaGaUwr9qXR3lCySRZY1FGiqNzSrYKLAKyqjVCAEGiQiuiNVRlNGBdzExSiHyC2R4/quPuvZSk5xPYk5jJl0AzvMHVd7cOHRZF3fBiz8uJuUeS7FfCMGbTB0iTJ1JkwBuegRr62CvWL3HvPgAiQJ1Hiq96ROhQpJ7YuLRgX1qYXHYvgNR7Q4BlR/ezmeBjLlzRBER5rvzWEw4GJieCK/Dmu1Gh5hWKaT0VvHfqPLMNwa6aHFvaMIADRmGU66zBIj912mCXNUgCuzK4cRsfBb9PD43M/wBIVqlTA4ApSakxpcVS2FsqmyqY8/vNEwAMzj04eiutYBsueurh1W4uGjVrGimB+bLB/wCRPwUMs6iPBi5SvwjqfZu+7VrgJIZpJ3lbJCo4Fh3YUWs4nV3iVowtWHlwXLuYuocHkfDsDUXkopCg+VbZTRFpKlKQTwmmBFJOlCYiKScpBIBkylCaExkSoFTIUCgAb0B6sOQHoArvQHFWKiA4JkQaSUJIGRDXDYItGnm4p23rJhWKdZvBQoLCUrcjirlOlI1WZXvyB3RKEMVqOEBhlRboktmr7oAZnYyq9zXhBthVJlyFenUhZ87dGvpkroqXNystozP12Vm5CxnCrUqBtPQA9551DegHErGns6PjRqV8POY1G1XAxETp5jZZ9wbjcZd9yT6K+/DKka3H/EBU61pWAOWq12mzmkSfEHbyU/ljU9d0wNJ9dzSypBnjtAW9h9TuweC5o39Sn/uUz4sOcfr8lq4fd5m5hs7VNx4lduT2bYqogAPisf3hWqFZShMhPGaDdAT+ESo4HhQDzUgBs5tPvPI1J85VLGL4U2MBOr3TpybvPxC3MNxOlkptOZhcwOGfTMDxB2WiGPk9rscvJ8QxY5Sx8ql/PPY0k4CGavSUVuqvILY0IbzCMWoVShPFAyjWxJrdFOlftPFO/DGlA/ysA6IAtC4BTuroIoloQqFy5zi3IRHFFhRap1Z4ImdQaDyRMqkIWZKUxaEiiwE5DITGsmLiiwIOQXojiUA1NYhOxAqgQXo7lWqOTExklGUkAZ1vZvata2cBod04BKlTtQTJ4KFjSQbTkpMqAcEz2kbKAouJ2USRZddbATqqV3Te7WNfVNfXgptgEZvLTy5rk8SxarJ1Px1VWRxqmcvP8XWLJxxLk1/YuXVczl2I3B0IR7Wu1ggcVz//AFAfs1WioBp3pD2+Dxr5IrcRoHVtRw/LU4eDhoVgeux2On+KY8yXL8L9jaqS8E5oHTdVKnd2cT4wdVWp3IP2SDPIgodad1JWzpwyRaLlOoHDUItqWiRCz6LSiOcG6uIA5kwPmrKbIcoxZccRKtWh16cTyHNYZxegP+4HdG975jRU8RxovaWNGVnHm4denRNRruZOr+JY8caTt+xHHcSNet3JLRDaY5gHfzJJ8wvTqdsG0aTSAezptaZAMkAArz72Kwo1q4qOHconMTzdu0fVemtEghb+mjrk/JwMKc3KcvJC1ywcndI3H3fh+istqFw5Ebjl+yoBuV381VqhUgwdjsforZRv7m3GlB60h2NfOp0R3KYcE+VUUaSprO6K1p5onYhMKZlFDsgQmjoj5AnhMRXhMQrBCG+oBogADmoJq6wrRqhIxvCAAwEzzCLpOyd1IFFgZ9WuRwQTU6LRqU+SqVR0TsKKzigPVl1ORKqVyRwRYqI6JKoQ/kUkch8TTYVYpoLAj00hB2joqWJ3+TutOvH8v7qd7ddmyRudAuJu8a/1HNHAxPM8VVlyKCOJ8U6ycfycPq8v2X/TRrszSTueJ3+K5/ES5p11HDohYtj72QG+ZVS1xV1WQ7hwPFY3NM43T9Nlgub7ArjVZ1enxW1Z4a+vWp02SZcJ2GVs94k9AvR7axotLqVOmG5Wta52VuZwE/adEuPjzThi5bO70mCWVWtI8TqVnN2JEciR807cYuG6Cq7zh39wK9ixDCrd7WsNJjg1oaNBIA2gjbyXP3XsHavEsL2axo4OE8odJVscT8HSfT5MSv8AwecVcWuHaGs/yOX+2FVILjLiSebiSfmvRm/4c0+NZ/k1q0bT2EtWRmD3/wDk6B8GgK1YZsrcpM84sGkkAAkk6Aak+C7fAfZKrVIdVBps5H7bh0HDz+C7HDsLo0tKdNrOoAn47rTaFbDpop3LZneBSdyFY2bKLBTY3K1u3XmSeJ6otM96QibjwUWDVaWXxVaQWtTBEjdBYJ05bKVSpBlIniEfUkgLLkCqabtM0Fh5zuD5grRb4rmvaV+V1JwMS10Hq1zSP7iuisqgexrx95oPnxVMu5n6TPJ5Z4Zfp2vs/wDQQOKTanNOUoCidEftRzU5QYCkCgCcqtcuA4I+ZDcSSgCuHtMSCiuqhFgck2UckAQ0UToiOCFKQCJBVeq2UZzQgOp9VKgKxpkHfRRIhTuGxxVJ1XfxUbGGylJCFdJMCYKJTYFWpvT3tz2dJ7+TdPHYJy0rZRKajFyfgzMUu8zzGzNB1PFcViFLK4uHPVdEToPDVZN+3nxXMyS5OzyOPNKeaU3+oxriHjVZ7y6kQ9vA6+HFX69FRo2+ckO0aAS48gFBHUxySX0PRfYSgzsO3A1rPgO/II0HnM+HRaeHUj2ter91wAaSCJ3zETuPsweilgdClTtqFNjQGNptIG4l3eJ66klSvL8bDZak1FUen6XCoY4xXgr3Gs+PPdBtaZYCXkFxcTpwnh6IdS6Gyancbzz2U4svnFmpRrtOhMHgEYhYjIa5zwSS6P6QBsOi0rK4zCDuFqxzvRiz49ckWmhGaUFr1KVbRlLVF42SaNUAI7TKYhqiAx8IziqzihodmH7fz7p2jd6NQH+l/dPzLfgj+wOIk0W0XmXAEgnqZI+au4lQ7WhVpn71N0eIEj5gLhcOqOa1r2mC10/z5LLl1NSOZ1mV4Msckf3+v0PW4TLKwbFO3YDxGjh15rSzJo7OPJHJFTj2ZIpmJi5IuhMmSzJSgk8VE1UAWZUTUQXXLRuUFt8w7FAFvMEN3RMXNUSBCQEKtSNFEnRMXjioVasJoBqhlUqwU6tQkHLoYWdb0X/edsUDLXZJ00J0xAKDcoAGvUrK9qrgim1mnfcNFpUbkzq06Ll/aW6z3FNo2D2j4b+pVWeX4Puc7r5ccVe5K/uwzx4BZOIV5yuJ3H1Ubl3a1y2dAdTyA3VPG71pc1rdmCFz3tnCwYKcV57shVrgAlV8KxDtHVGHcsPyOqz7i66rocEwttJhrP8A9yo2I/C0/VSSVbOhOMMWNuXd9jpvZfFs9BtMnvURkI6N0afMQr1e4XCvrOp1M9M68eThyK1rfGGvGuh4gpnpOh6yOSCT0zXqV0hccjss9laeKc1QFNSNzNalX01O/wAkawrBhOpJc7Qk8zoPBYDrmZ12W37O2XaEVH/Zb9kfjPPwWjHyk6RRlcYRbkdKUg5ScEMroUcewzXojKkKqx2qK4pUSLkgqrXEFRa4hEJzCCpURBMfBXEX1xSo1qtJ2mV5g9Hd5vyIXZvYRwXD/wCIFuM1OrsXMynqWHT5O+Sz9QnwteDF1uCOWCvwXMC9om0q7WT3X6E+k+a79t6CvAg8kyCvYPZO9Fa2Y532m913lsVmwzvTJ9Alh/K99/udCKwPFP2gVFrRO6LAVx1SxmCDVp5uMKJcEswQAN1mFKlQA2CnnCj2iAGeyT4KT6iE+ohEwgBVqh4CVWrXJG7TKK7N+6YgFIZVbVqF20CPgpkRrKI07qvVrAaQSiwoMHhJBa/okmIrWl5nkgQAYHVcZi4LLszsHOePAjMkkqM/pMHXxTgn/OxjX16KLCB9uoJceQOoaFzL7tzzDUklVjiqsXS44rHzrZu4JhjqY94qwRoGDeJI7x8vVbV/dySOE+uoSSVUnZzZSeWblLw2jGrV9Y4IHb+adJBtjFDtvSNnEeZR6d68ic+g6TqZj0KdJTj3NMcs4rUmWsPDnvbJJAEvBI0MnlvsRC9AtMRAiBEABMkt+DSLOTmrk7NenfNKsCo0pJLYmVtEXUeSKx6SSACtUiEySkAxMLgf8Va7WtosG7i53lASSVPUf02RkrRwNF67n2TxHI1okw52Ux14p0lysbpnO6puFSjppna0rSCTncfFW2mEklsO8uwsyUpJIGNmSlJJAA+2EE8lWN+0iW6+SSSQybajjOyr1X5T00SSR5GRurqJbtpvyVA1C0SSTKSSmkRYRldxE7JJJJkbP//Z']);
    }
}
